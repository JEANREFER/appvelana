(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[828],{1002:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vendor/requests",function(){return t(6135)}])},6135:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var n=t(5893),r=t(7294),a=t(1163);function l(){let e=(0,a.useRouter)(),[s,t]=(0,r.useState)([]),[l,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),[u,c]=(0,r.useState)(""),[p,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{let s=async()=>{let s=localStorage.getItem("user");if(!s)return e.push("/login");let n=JSON.parse(s);if("prestataire"!==n.role)return e.push("/");let r=await fetch("/api/vendor/requests?userId=".concat(n.id)),a=await r.json();t(a)};s()},[]);let h=e=>{d(e),c(e.responseMessage||""),i(!0)},m=async e=>{if(e.preventDefault(),!o)return;let s=new FormData;s.append("id",String(o.id)),s.append("responseMessage",u),p&&s.append("file",p);let n=await fetch("/api/vendor/respond",{method:"POST",body:s});if(n.ok){alert("R\xe9ponse envoy\xe9e"),i(!1);let e=JSON.parse(localStorage.getItem("user")||"{}"),s=await fetch("/api/vendor/requests?userId=".concat(e.id)),n=await s.json();t(n)}else alert("Erreur lors de l'envoi")};return(0,n.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Demandes de devis re\xe7ues"}),0===s.length?(0,n.jsx)("p",{children:"Aucune demande re\xe7ue."}):(0,n.jsx)("ul",{className:"space-y-4",children:s.map(e=>(0,n.jsxs)("li",{className:"bg-white border rounded shadow p-4",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Nom :"})," ",e.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Email :"})," ",e.email]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Message :"})," ",e.message]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Re\xe7u le ",new Date(e.createdAt).toLocaleDateString()]}),e.responseMessage&&(0,n.jsxs)("div",{className:"mt-2 text-green-700",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"R\xe9ponse :"})," ",e.responseMessage]}),e.responseFile&&(0,n.jsx)("a",{href:e.responseFile,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"Voir le fichier"})]}),(0,n.jsx)("button",{onClick:()=>h(e),className:"mt-2 bg-blue-600 text-white px-3 py-1 rounded",children:"R\xe9pondre"})]},e.id))}),l&&o&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("form",{onSubmit:m,className:"bg-white p-6 rounded shadow w-full max-w-lg",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"R\xe9pondre \xe0 la demande"}),(0,n.jsx)("textarea",{placeholder:"Votre message",value:u,onChange:e=>c(e.target.value),className:"w-full border p-2 mb-3 rounded"}),(0,n.jsx)("input",{type:"file",accept:"application/pdf",onChange:e=>{var s;return x((null===(s=e.target.files)||void 0===s?void 0:s[0])||null)},className:"w-full border p-2 mb-3 rounded"}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Envoyer"}),(0,n.jsx)("button",{type:"button",onClick:()=>i(!1),className:"bg-gray-500 text-white px-4 py-2 rounded",children:"Annuler"})]})]})})]})}},1163:function(e,s,t){e.exports=t(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=1002)}),_N_E=e.O()}]);